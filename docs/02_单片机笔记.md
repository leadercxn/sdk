# 单片机笔记
## 1. ADC
1. ADC读通道转换结果
   1. 规则模式
      1. 单通道--可以使用轮询、中断、DMA，轮询/中断直接从`ADC_GetConversionValue`获取转换结果
      2. 多通道
         1. 非间断模式--DMA，因为每次转换结束，`ADC_FLAG_EOC`会在全部通道转换结束后才会置位，而ADC_DR仅存储最后一个通道的转换结果，因此不适用中断/轮询方式获取多通道非间断方式
         2. 间断模式
            1. 可以使用DMA
            2. [TBD]使用中断--但是有种说法，间断模式下，当所有的通道转换结束之后才会触发`EOC`中断
               1. Note: 使用中断获取通道值只适用每个分组只有1个通道的情况，如果每个分组有多个通道，同上道理
            3. 不建议使用了轮询，因为获取对应通道结果的时刻不一定跟该通道转换结束的时间点匹配上
   2. 注入模式
      1. 单通道--轮询、中断，从`ADC_GetInjectedConversionValue`获取对应通道的转换结果，
      2. 多通道--轮询、中断
         1. 在注入模式中，可以通过对`ADC_GetInjectedConversionValue`执行多次读操作，即可以实现多通道转换值的读取
         2. 规则模式中，把ADCx->DR直接映射到内存变量中，DMA需要设置外设地址不变，但是在注入模式中，外设地址需要根据实际的通道情况实际配置(注入模式的转换结果存储在`(uint32_t)ADCx+ADC_InjectedChannel + JDR_Offset`)
      3. 注入模式不支持DMA[TBD]
2. 若芯片没有Vref管脚，则参考电压为MCU供电电压,否则参考电压等于Vref
3. 在使用外部信号触发ADC采样时，只能使用高电平触发，因此定时器触发只有PWM模式才可以触发
4. 使用外部信号触发ADC采样时，获取采样结果建议使用DMA/中断方式，如果使用轮询方式获取，每次轮询的时间可能会和转换成功的时间对不上，导致程序卡死的情况(轮询需要一直等待转换成功标志位)
5. 使用外部信号触发时，不能使用连续触发方式，不然就只有第一次ADC触发是定时器导致的，后续的触发都是由单片机自动触发所引起的,从而外部触发没意义
6. 间断模式
   1. 功能:把需要采样的m个通道进行分组管理，每组有n个通道，当采样被触发时，每次会采样n个通道，若m%n!=0，则最后一次转换只采样m%n个通道，当所有通道都被采样完成才会产生EOC事件，并且在下一次触发时，会从头开始采样
   2. 目的:当有场合需要各个采样通道进行分时采样，间断模式是个好方法
   3. 因为每次转换被触发之后并不会产生EOC中断，因此间断模式不适合使用轮询/中断方式对转换结果进行采样；但是使用DMA获取采样结果时，DMA缓存需要适当配置
      1. 如上所述，m个通道，分组n个通道进行管理，因为每次转换n个通道，因此DMA缓存数组大小不能设置为m，应该设置为n
   4. 规则模式/注入模式不能同时设置间断模式
   5. [TBD]间断模式不能与连续模式共用
7. 


ADC模块工作
1. [ok]其他触发方式--定时器
   1. 单通道/多通道
2. 常规模式--轮询、中断、DMA
   1. [ok]非间断模式，单通道/多通道--轮询、中断、DMA
   2. [ok]间断模式，多通道--DMA，中断只使用n=1的情况，轮询不适用
3. 注入模式--轮询、中断、DMA
   1. 非间断模式，单通道/多通道
   2. 间断模式，单通道/多通道
4. 双ADC模式

